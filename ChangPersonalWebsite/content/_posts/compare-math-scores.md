Comparing Math Standardized Score Between Large and Small Schools in California
===============================================================================

Background
----------

The data contains the average standardized test scores of grade 5
students in each school in California in the school year of 1998 through
1999. On top of the scores, information are collected on areas such as
the number of students enrolled in the school, number of computers per
classroom, the percentage of students in school that qualify for a
reduced price lunch, and the percentage of students whose first language
is not English in the school.

For our purposes, we will separate the schools into two sub-population.
The first sub-population is composed of schools that have more than 1000
students, and the second sub-population is composed of schools with
fewer than 1000 students. We will compare the standardized score for
math between schools of different sizes.

    School.Big = CASchools$math[CASchools$students==1]
    School.Small = CASchools$math[CASchools$students==0]
    pop = list(pop1 = School.Big , pop2 = School.Small)

We will consider the following 2 discrepancy measure,
$\\mathcal D\_1(\\mathcal P\_1,\\mathcal P\_2)=\\frac{SD(\\mathcal P\_1)}{SD(\\mathcal P\_2)}-1$
and
$\\mathcal D\_2(\\mathcal P\_1,\\mathcal P\_2)=\\frac{\\bar{Y\_1} - \\bar{Y\_2}}{\\tilde{\\sigma} \\sqrt{\\frac{1}{n\_1}+\\frac{1}{n\_2}}}-1$.
Note that 𝒟<sub>1</sub> is a measure of spread and 𝒟<sub>2</sub> is a
measure of central tendency.

First, let’s make a function to generate random shuffles in R.

    mixRandomly <- function(pop) {
      pop1 <- pop$pop1;  n_pop1 <- length(pop1)
      pop2 <- pop$pop2; n_pop2 <- length(pop2); mix <- c(pop1,pop2)
      select4pop1 <- sample(1:(n_pop1 + n_pop2), n_pop1,  replace = FALSE)
      new_pop1 = mix[select4pop1]; new_pop2 = mix[-select4pop1]
      list(pop1=new_pop1, pop2=new_pop2)
    }

Now,we define functions that calculate our discrepancy measures.

    # D1 as a function
    D1Fn <- function(pop) {
        ## First sub-population
        pop1 <- pop$pop1; n1 = length(pop1); SD1 <- sqrt(var(pop1)*(n1-1)/n1)
        ## Second sub-population
        pop2 <- pop$pop2; n2 = length(pop2); SD2 <- sqrt(var(pop2)*(n2-1)/n2)
        ## Determine the test statistic
        temp <- SD1/SD2 - 1
        temp
    }

    # D2 as a function
    D2Fn <- function(pop) {
        ## First sub-population
        pop1 <- pop$pop1; n1 <- length(pop1); m1 <- mean(pop1); v1 <- var(pop1)
        ## Second sub-population
        pop2 <- pop$pop2; n2 <- length(pop2); m2 <- mean(pop2); v2 <- var(pop2)
        ## Pool the variances
        v <- ((n1 - 1) * v1 + (n2 - 1) * v2)/(n1 + n2 - 2)
        ## Determine the t-statistic
        temp <- (m1 - m2) / sqrt(v * ( (1/n1) + (1/n2) ) )
        temp
    }

Here, we generated the histograms of our 2 discrepancy measures based on
5000 shuffles of the two sub-populations.

    par(mfrow = c(1,2))

    # Plot for D1
    D1Vals <- sapply(1:5000, FUN = function(...) {
      D1Fn(mixRandomly(pop))})

    hist(D1Vals, breaks=40, probability = TRUE, 
         main = "Permuted populations", xlab="D1 statistic")
    abline(v=D1Fn(pop), col = "red", lwd=2)

    # Plot for D2
    D2Vals <- sapply(1:5000, FUN = function(...){ D2Fn(mixRandomly(pop)) })
    hist(D2Vals, breaks=40, probability = TRUE,  
         main = "Permuted populations", xlab="D2 statistic")
    abline(v=D2Fn(pop), col = "red", lwd=2)

![](a5q2_files/figure-markdown_strict/unnamed-chunk-5-1.png) From this
graph, we could see that our two sub-populations of the math
standardized score of large vs small schools seems to be a random mix of
the parent population when considering measures of the spread,
𝒟<sub>1</sub> and when considering measures of the central tendency,
𝒟<sub>2</sub>. We know this because the red line is very close to the
center of the histogram.

Now, let’s test the null hypothesis and check whether our two
sub-population is indeed generated by random mixing for
𝒟<sub>2</sub>(𝒫<sub>1</sub>, 𝒫<sub>2</sub>)

    D2obs = D2Fn(pop) 
    mean(abs(D2Vals) >= abs(D2obs))

    ## [1] 0.6058

Since our value here is very large and much more than 0.1. We know that
there is no evidence against the null hypothesis. In the context of our
situation, there is no evidence that the math score in large schools
vs. small schools is *not* a random mix of the parent population. In
other words, it is very likely that the standardized math scores in
large schools and small schools came from the same parent population.

In the real world context, we know that the size of the school may have
little to no effect on the math standardized score of Grade 5 students
in California, which is excellent because everyone gets access to
quality math education regardless of school sizes!
